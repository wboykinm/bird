<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Bird</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <!--<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.css' rel='stylesheet' />-->
    <link href='lib/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { 
          margin:0; 
          padding:0; 
          background-image: url('sanborn_texture.png');
          background-repeat: repeat;
        }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>
<!--<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.js'></script>-->
<script src='lib/mapbox-gl.js'></script>
<script>
  var locations = [{
    "id": "2",
    "camera": {
      center: [-73.213544, 44.476507],
      zoom: 16,
      pitch: 0,
      bearing: -2.8,
      speed: 0.08,
      curve: 1
    }
  }, {
    "id": "3",
    "camera": {
      center: [-73.213544, 44.476507],
      zoom: 15,
      pitch: 50,
      bearing: 178,
      speed: 0.05,
      curve: 1
    }
  }, {
    "id": "4",
    "camera": {
      center: [-73.213544, 44.476507],
      zoom: 14,
      speed: 0.01,
      curve: 1.5,
      pitch: 60,
      bearing: 57
    },
    "layers": ["bird-tiles"],
    "repaint": [
      "raster-opacity",
      [ "interpolate", ["linear"], ["zoom"], 14, 1, 16, 0 ]
    ]
  }]
  
  var route = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "type": "LineString",
          "coordinates": [
            [
              -73.21497201919556,
              44.467141778662125
            ],
            [
              -73.21546554565428,
              44.47358832905586
            ],
            [
              -73.21851253509521,
              44.47351177087768
            ],
            [
              -73.21874856948851,
              44.47686492494367
            ],
            [
              -73.21411371231079,
              44.47704865384501
            ],
            [
              -73.21353435516357,
              44.47649746540553
            ]
          ]
        }
      }
    ]
  }

  var startPoint = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "type": "Point",
          "coordinates": [
            -73.21497201919556,
            44.46713603616803
          ]
        }
      }
    ]
  }
  var endPoint = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "type": "Point",
          "coordinates": [
            -73.21353435516357,
            44.47651469012308
          ]
        }
      }
    ]
  }

  mapboxgl.accessToken = 'pk.eyJ1IjoibGFuZHBsYW5uZXIiLCJhIjoiY2prY3MzYngzMGNsdTNrcW0yM3doaXplOSJ9.796so4xYNFZW4UK5lOgapw';
  var map = new mapboxgl.Map({
      style: 'mapbox://styles/landplanner/cjmjvl3jl074u2sru0wd4hl2n',
      center: [-73.213544, 44.476507],
      zoom: 19,
      pitch: 0,
      bearing: -2.8,
      container: 'map'
  });
  
  function playback(i) {
    // Animate the map position based on camera properties
    map.flyTo(
      locations[i].camera
    );
    map.once('moveend', function() {
      if (locations[i].layers) {
        for (var l = 0; l < locations[i].layers.length; l++) {
          map.setPaintProperty(locations[i].layers[l], locations[i].repaint[0], locations[i].repaint[1]);
        }
      }
      window.setTimeout(function() {
        i = (i + 1 === locations.length) ? 0 : i + 1;
        playback(i);
      }, 1000);
    });
  }
  
  map.on('load', function() {
    
    map.addControl(new mapboxgl.NavigationControl());
    
    map.addSource('sanborn', {
      "type": "raster",
      "tileSize": 256,
      "tiles": ["https://mapwarper.net/maps/tile/33964/{z}/{x}/{y}.png"]
      // Sanborn:
      //"tiles": ["https://mapwarper.net/mosaics/tile/983/{z}/{x}/{y}.png"]
    });
    
    map.addLayer({
      "id": "bird-tiles",
      "type": "raster",
      "source": "sanborn",
      "minzoom": 0,
      "maxzoom": 22
    }, 'border-admin-2')
    
    playback(0);
  });
</script>

</body>
</html>